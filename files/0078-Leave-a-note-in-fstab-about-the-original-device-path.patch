From 16a7445de520b88df8ce0eb024a217633d8260d7 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Sun, 12 Jun 2016 23:03:51 +0100
Subject: [PATCH 78/85] Leave a note in fstab about the original device path

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 os_installer2/diskman.py     | 2 +-
 os_installer2/postinstall.py | 2 ++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/os_installer2/diskman.py b/os_installer2/diskman.py
index 6fa2c4f..a11e64f 100644
--- a/os_installer2/diskman.py
+++ b/os_installer2/diskman.py
@@ -388,7 +388,7 @@ class DiskManager:
         }
 
         # Set up UEFI knowledge
-        if os.path.exists("/sys/firmware/efi"):
+        if not os.path.exists("/sys/firmware/efi"):
             self.is_uefi = True
             pl_f = "/sys/firmware/efi/fw_platform_size"
             if os.path.exists(pl_f):
diff --git a/os_installer2/postinstall.py b/os_installer2/postinstall.py
index 02387e1..b50a65f 100644
--- a/os_installer2/postinstall.py
+++ b/os_installer2/postinstall.py
@@ -547,7 +547,9 @@ class PostInstallFstab(PostInstallStep):
             if isinstance(op, DiskOpUseHome):
                 huuid = get_part_uuid(op.home_part.path)
                 fs = op.home_part_fs
+                desc = "# {} at time of installation".format(op.home_part.path)
                 i = "UUID={}\t/home\t{}\trw,relatime,errors=remount-ro\t0\t0"
+                appends.append(desc)
                 appends.append(i.format(huuid, fs))
                 continue
             if disk.type == "gpt" and strat.is_uefi():
-- 
2.8.3

