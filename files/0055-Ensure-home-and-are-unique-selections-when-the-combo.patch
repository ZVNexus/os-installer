From fc9cd2b1794add93410bf161cac81fec287a714a Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Sun, 12 Jun 2016 19:42:06 +0100
Subject: [PATCH 55/84] Ensure /home and / are unique selections when the combo
 changes

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 os_installer2/pages/partitioning.py | 26 +++++++++++++++++++++++---
 1 file changed, 23 insertions(+), 3 deletions(-)

diff --git a/os_installer2/pages/partitioning.py b/os_installer2/pages/partitioning.py
index 4d6b204..6707732 100644
--- a/os_installer2/pages/partitioning.py
+++ b/os_installer2/pages/partitioning.py
@@ -162,8 +162,18 @@ class ManualPage(Gtk.VBox):
 
     def set_root_partition(self, path):
         """ Update the root partition """
-        print("Updating root partition")
-        pass
+        model = self.treeview.get_model()
+        row = model[path]
+        active_part = row[INDEX_PARTITION_PATH]
+        for p in model:
+            skip_part = p[INDEX_PARTITION_PATH]
+            skip_mount = p[INDEX_PARTITION_MOUNT_AS]
+            if skip_part == active_part:
+                # TODO: Force format!
+                continue
+            # Reset anyone trying to be root..
+            if skip_mount == '/':
+                p[INDEX_PARTITION_MOUNT_AS] = None
 
     def set_swap_partition(self, path):
         """ Update the swap partition """
@@ -171,7 +181,17 @@ class ManualPage(Gtk.VBox):
 
     def set_home_partition(self, path):
         """ Update the home partition """
-        pass
+        model = self.treeview.get_model()
+        row = model[path]
+        active_part = row[INDEX_PARTITION_PATH]
+        for p in model:
+            skip_part = p[INDEX_PARTITION_PATH]
+            skip_mount = p[INDEX_PARTITION_MOUNT_AS]
+            if skip_part == active_part:
+                continue
+            # Reset anyone trying to be /home..
+            if skip_mount == '/home':
+                p[INDEX_PARTITION_MOUNT_AS] = None
 
     def push_partition(self, drive, part):
         model = self.treeview.get_model()
-- 
2.8.3

