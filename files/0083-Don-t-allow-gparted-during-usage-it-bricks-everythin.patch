From e8ee3de6f231206af9ee3462c4524611bd2ac618 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Mon, 13 Jun 2016 00:30:03 +0100
Subject: [PATCH 83/85] Don't allow gparted during usage, it bricks everything

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 os_installer2/pages/partitioning.py | 59 ++-----------------------------------
 os_installer2/strategy.py           |  5 ++--
 2 files changed, 6 insertions(+), 58 deletions(-)

diff --git a/os_installer2/pages/partitioning.py b/os_installer2/pages/partitioning.py
index 7dbe75f..0ef7c5d 100644
--- a/os_installer2/pages/partitioning.py
+++ b/os_installer2/pages/partitioning.py
@@ -58,7 +58,9 @@ class ManualPage(Gtk.VBox):
                         "the available partition selection below.\n"
                         "Only available system partitions and swap will be "
                         "displayed here. Use gparted to edit partitions\nin "
-                        "order for them to be displayed.")
+                        "order for them to be displayed."
+                        "When modifying partitions outside of the installer, "
+                        "you will have\nto restart the installer.")
         self.pack_start(lab, False, False, 0)
         lab.set_margin_top(20)
         lab.set_margin_bottom(20)
@@ -81,8 +83,6 @@ class ManualPage(Gtk.VBox):
         self.set_border_width(12)
         self.scrl.set_policy(Gtk.PolicyType.NEVER, Gtk.PolicyType.AUTOMATIC)
         self.scrl.set_shadow_type(Gtk.ShadowType.ETCHED_IN)
-        sd = Gtk.JunctionSides.BOTTOM
-        self.scrl.get_style_context().set_junction_sides(sd)
         self.pack_start(self.scrl, True, True, 0)
 
         # device
@@ -130,18 +130,6 @@ class ManualPage(Gtk.VBox):
         self.column9.add_attribute(ren, "markup", INDEX_PARTITION_FREE_SPACE)
         self.treeview.append_column(self.column9)
 
-        toolbar = Gtk.Toolbar()
-        toolbar.get_style_context().add_class(Gtk.STYLE_CLASS_INLINE_TOOLBAR)
-        junctions = Gtk.JunctionSides.TOP
-        toolbar.get_style_context().set_junction_sides(junctions)
-
-        gparted = Gtk.ToolButton()
-        gparted.set_label("Launch Partition Editor")
-        gparted.connect("clicked", self.launch_gparted)
-        gparted.set_is_important(True)
-        toolbar.add(gparted)
-        self.pack_start(toolbar, False, False, 0)
-
     def on_format_toggled(self, widget, path):
         model = self.treeview.get_model()
         row = model[path]
@@ -160,52 +148,11 @@ class ManualPage(Gtk.VBox):
         row[INDEX_PARTITION_FORMAT] = not row[INDEX_PARTITION_FORMAT]
         self.update_selection()
 
-    def launch_gparted(self, btn, udata=None):
-        """ Send off a thread """
-        self.info.owner.set_sensitive(False)
-        t = threading.Thread(target=self._launch_gparted)
-        t.start()
-
-    def _launch_gparted(self):
-        """ Launch this on the thread so the UI doesnt lock """
-        perms = self.info.owner.get_perms_manager()
-        perms.up_permissions()
-        dm = self.info.owner.get_disk_manager()
-        prober = self.info.prober
-        # Start external access
-        for drive in prober.drives:
-            if not drive.device:
-                continue
-            drive.device.beginExternalAccess()
-
-        try:
-            os.system("gparted")
-        except:
-            pass
-
-        # Stop access
-        for drive in prober.drives:
-            if not drive.device:
-                continue
-            drive.device.endExternalAccess()
-
-        prober = DriveProber(dm)
-        self.info.prober = prober
-        self.info.prober.probe()
-        perms.down_permissions()
-        self.info.invalidated = True
-        self.selection_root = None
-        self.selection_home = None
-        self.selection_swap = None
-
-        GLib.idle_add(self.restore_ui)
-
     def restore_ui(self):
         self.info.owner.set_sensitive(True)
         self.queue_draw()
         self.populate_ui()
         self.update_selection()
-        # TODO: Refresh
 
     def on_mount_changed(self, widget, path, text):
         model = self.treeview.get_model()
diff --git a/os_installer2/strategy.py b/os_installer2/strategy.py
index 9f69fbd..c4dcfc3 100644
--- a/os_installer2/strategy.py
+++ b/os_installer2/strategy.py
@@ -623,8 +623,9 @@ class UserPartitionStrategy(DiskStrategy):
         self.drive = drive
 
     def get_display_string(self):
-        sz = "Create, resize and manually configure disk partitions yourself" \
-             ". This method\nmay lead to <b>data loss.</b>"
+        sz = "Assign mount points to partitions you have previously created." \
+             "\nThese must already exist prior to launching the installer. If" \
+             "\nyou modify them, please restart the installer."
         return sz
 
     def get_name(self):
-- 
2.8.3

