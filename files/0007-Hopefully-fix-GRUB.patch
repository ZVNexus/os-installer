From 95e7e93f23881077e8154b47a214dcb7059b4143 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Fri, 10 Jun 2016 23:47:21 +0100
Subject: [PATCH 07/32] Hopefully fix GRUB ..

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 os_installer2/pages/progress.py | 2 ++
 os_installer2/postinstall.py    | 3 ++-
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/os_installer2/pages/progress.py b/os_installer2/pages/progress.py
index 974af8d..63c2986 100644
--- a/os_installer2/pages/progress.py
+++ b/os_installer2/pages/progress.py
@@ -528,6 +528,8 @@ class InstallerProgressPage(BasePage):
             # If it created a disk, go use it.
             if isinstance(op, DiskOpCreateDisk):
                 disk = op.disk
+                if not strategy.disk:
+                    strategy.disk = disk
                 # Now set the part offset
                 part_offset = disk.getFirstPartition().geometry.end + part_step
             elif isinstance(op, DiskOpResizeOS):
diff --git a/os_installer2/postinstall.py b/os_installer2/postinstall.py
index 75438f9..b9ed45b 100644
--- a/os_installer2/postinstall.py
+++ b/os_installer2/postinstall.py
@@ -594,7 +594,8 @@ class PostInstallBootloader(PostInstallStep):
         """ Take the BIOS approach to bootloader configuration """
         if not self.info.bootloader_install:
             return True
-        cmd = "grub-install \"{}\"".format(self.info.bootloader_sz)
+        cmd = "grub-install --force \"{}\"".format(self.info.bootloader_sz)
+        print("DEBUG: GRUB: {}".format(cmd))
         if not self.run_in_chroot(cmd):
             self.set_errors("Failed to install GRUB bootloader")
             return False
-- 
2.8.3

