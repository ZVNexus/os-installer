From ca12755410c6a51939d13475ed60d26ba9fafafb Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Thu, 14 Apr 2016 05:08:50 +0100
Subject: [PATCH 4/5] Quick-fix, set the mount-count to 31 to prevent
 unnecessary fsck on boot

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 os_installer/installer.py | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/os_installer/installer.py b/os_installer/installer.py
index 2e3b2a6..5235cc3 100644
--- a/os_installer/installer.py
+++ b/os_installer/installer.py
@@ -67,6 +67,15 @@ class InstallerEngine:
                 p = Popen(cmd, shell=True)
                 p.wait() # this blocks
                 partition.type = partition.format_as
+
+                # Now set the mount type
+                if partition.format_as in ["ext3", "ext4"]:
+                    cmd = "tune2fs -c 31 {}".format(partition.partition_path)
+                    try:
+                        p = Popen(cmd, shell=True)
+                        p.wait()
+                    except Exception as e:
+                        print("Failed setting mount-count: {}".format(e)
                                         
     def step_mount_partitions(self, setup):
         # Mount the installation media
-- 
2.8.1

